// Legacy file kept for compatibility.
// The site now loads ES modules from js/main.js.
// (Intentionally left as a no-op.)
/*
  ru: {
    brand: 'Vətən Restoran',
    nav_home: 'Главная',
    nav_about: 'О нас',
    nav_menu: 'Меню',
    nav_gallery: 'Галерея',
    nav_contacts: 'Контакты',
    hero_title: 'Veten',
    hero_subtitle:
      '«Vətən» — место, где глубина и тонкость азербайджанской кухни раскрываются на новом уровне. Здесь традиции не просто сохраняются — они переосмысляются со вкусом и подаются в современном прочтении.\n\n' +
      'Основа нашей кухни — отборные местные продукты, точность и высокая культура вкуса. Каждая подача продумана, каждая деталь имеет цель — ничего случайного.\n\n' +
      'Атмосфера пространства — гармония спокойной элегантности и уюта. Интерьер, музыка и сервис создают единое ощущение — здесь всё выстроено тонко.\n\n' +
      '«Vətən» — не просто ресторан. Это избранный опыт вкуса, эстетики и культуры.',
    about_title: 'О ресторане',
    about_p1: 'Ресторан «Vətən» — семейное заведение с настоящей азербайджанской кухней. Здесь традиционные рецепты готовятся с заботой и уважением к культуре, а блюда создаются только из свежих местных продуктов. В меню — сочные шашлыки, ароматный плов, нежная долма и домашние сладости, которые передают вкус Азербайджана в каждой ложке.',
    about_p2: 'Интерьер ресторана тёплый и уютный, создающий атмосферу настоящего дома. Дружелюбное обслуживание и внимание к деталям делают каждый визит особенным, а время, проведённое здесь, запоминается своей комфортной и душевной атмосферой.',
    menu_title: 'Наше меню',
    branch_suffix: 'филиал',
    cat_hot: 'Горячие блюда',
    cat_salads: 'Салаты',
    cat_desserts: 'Десерты',
    cat_drinks: 'Напитки',
    cat_breakfast: 'Завтрак',
    cat_shisha: 'Кальян',
    gallery_title: 'Галерея',
    contacts_title: 'Контакты',
    rights: 'Все права защищены.',
    made_with_love: 'Сделано с <i class="fas fa-heart"></i> для ценителей азербайджанской кухни',
    menu_open_btn: 'Открыть полное меню',
    menu_download: 'Открыть изображение',
    menu_view_btn: 'Посмотреть меню',
    reserve_open_btn: 'Забронировать столик',
    reserve_title: 'Бронирование столика',
    reserve_branch: 'Филиал',
    reserve_date: 'Дата',
    reserve_time: 'Время',
    reserve_guests: 'Гостей',
    reserve_phone: 'Телефон',
    reserve_phone_placeholder: '+994...',
    reserve_email: 'Email (опционально)',
    reserve_email_placeholder: 'name@example.com',
    reserve_message: 'Сообщение',
    reserve_message_placeholder: 'Напишите дополнительные пожелания к брони',
    reserve_submit: 'Отправить',
    reserve_success: 'Заявка на бронирование отправлена. Мы свяжемся с вами по телефону в ближайшее время.',
    reserve_error: 'Не удалось отправить заявку. Попробуйте ещё раз или свяжитесь с нами по телефону.',
  },
  az: {
    brand: 'Vətən Restoran',
    nav_home: 'Ana səhifə',
    nav_about: 'Haqqımızda',
    nav_menu: 'Menyu',
    nav_gallery: 'Qalereya',
    nav_contacts: 'Əlaqə',
    hero_title: 'Veten',
    hero_subtitle:
      '“Vətən” — Azərbaycan mətbəxinin dərinliyini və incəliyini yeni səviyyədə təqdim edən məkandır. Burada ənənə sadəcə qorunmur — o, zövqlə yenidən düşünülür və müasir baxışla təqdim olunur.\n\n' +
      'Mətbəximizin əsasını seçilmiş yerli məhsullar, dəqiqlik və yüksək dad mədəniyyəti təşkil edir. Hər təqdimat düşünülmüşdür, hər detal məqsədyönlüdür — təsadüfi heç nə yoxdur.\n\n' +
      'Məkanın atmosferi sakit dəbdəbə və rahatlığın harmoniyasıdır. İnteryer, musiqi və servis vahid bir hiss yaradır — burada hər şey incəliklə qurulub.\n\n' +
      '“Vətən” — sadəcə restoran deyil. Bu, dad, estetika və mədəniyyətin seçilmiş təcrübəsidir.',
    about_title: 'Restoran haqqında',
    about_p1: '“Vətən” restoranı — əsl Azərbaycan mətbəxi ilə ailəvi məkan. Burada ənənəvi reseptlər mədəniyyətə hörmət və qayğı ilə hazırlanır, yeməklər isə yalnız təzə yerli məhsullardan yaradılır. Menyumuzda geniş seçim var: şirəli kabablar, ətirli plov, zərif dolma, ev şirniyyatları və daha bir çox dadlar — hər zövqə uyğun təam tapmaq mümkündür.',
    about_p2: 'Restoranın interyeri isti və rahatdır, elə bil doğma ev mühitini yaradır. Səmimi xidmət və detallara diqqət hər gəlişi özəl edir, burada keçirilən vaxt isə rahatlığı və ürəkliliyi ilə yadda qalır.',
    menu_title: 'Menyu',
    branch_suffix: 'filialı',
    cat_hot: 'İsti yeməklər',
    cat_salads: 'Salatlar',
    cat_desserts: 'Desertlər',
    cat_drinks: 'İçkilər',
    cat_breakfast: 'Səhər yeməyi',
    cat_shisha: 'Şişa',
    gallery_title: 'Qalereya',
    contacts_title: 'Əlaqə',
    rights: 'Bütün hüquqlar qorunur.',
    made_with_love: 'Azərbaycan mətbəxi sevənlər üçün <i class="fas fa-heart"></i> ilə hazırlandı',
    menu_open_btn: 'Tam menyunu aç',
    menu_download: 'Şəkli aç',
    menu_view_btn: 'Menyunu aç',
    reserve_open_btn: 'Masa bron et',
    reserve_title: 'Masa bronu',
    reserve_branch: 'Filial',
    reserve_date: 'Tarix',
    reserve_time: 'Saat',
    reserve_guests: 'Qonaq sayı',
    reserve_phone: 'Telefon',
    reserve_phone_placeholder: '+994...',
    reserve_email: 'Email (istəyə görə)',
    reserve_email_placeholder: 'name@example.com',
    reserve_message: 'Mesaj',
    reserve_message_placeholder: 'Bronla bağlı əlavə qeydlər yazın',
    reserve_submit: 'Göndər',
    reserve_success: 'Bron sorğunuz göndərildi. Tezliklə sizinlə telefonla əlaqə saxlanılacaq.',
    reserve_error: 'Sorğunu göndərmək alınmadı. Zəhmət olmasa bir daha cəhd edin və ya bizimlə telefonla əlaqə saxlayın.',
  },
  en: {
    brand: 'Veten Restaurant',
    nav_home: 'Home',
    nav_about: 'About',
    nav_menu: 'Menu',
    nav_gallery: 'Gallery',
    nav_contacts: 'Contacts',
    hero_title: 'Veten',
    hero_subtitle:
      '“Vətən” is a place where the depth and refinement of Azerbaijani cuisine are presented on a new level. Here, tradition is not merely preserved — it is thoughtfully reimagined and served with a modern perspective.\n\n' +
      'Our cuisine is built on carefully selected local ingredients, precision, and a strong culture of taste. Every presentation is considered, every detail has a purpose — nothing is accidental.\n\n' +
      'The atmosphere is a harmony of quiet elegance and comfort. The interior, music, and service create a unified feeling — everything here is crafted with finesse.\n\n' +
      '“Vətən” is not just a restaurant. It is a curated experience of taste, aesthetics, and culture.',
    about_title: 'About us',
    about_p1: 'Vətən Restaurant is a family venue with genuine Azerbaijani cuisine. Here, traditional recipes are prepared with care and respect for culture, and dishes are created only from fresh local ingredients. Our menu offers a wide variety of options — from juicy kebabs and fragrant pilaf to delicate dolma and homemade sweets — plus many more dishes, so everyone can find something they love.',
    about_p2: 'The interior is warm and cozy, creating the atmosphere of a real home. Friendly service and attention to detail make every visit special, and the time spent here is remembered for its comfort and heartfelt ambiance.',
    menu_title: 'Our Menu',
    branch_suffix: 'branch',
    cat_hot: 'Hot dishes',
    cat_salads: 'Salads',
    cat_desserts: 'Desserts',
    cat_drinks: 'Drinks',
    cat_breakfast: 'Breakfast',
    cat_shisha: 'Shisha',
    gallery_title: 'Gallery',
    contacts_title: 'Contacts',
    rights: 'All rights reserved.',
    made_with_love: 'Made with <i class="fas fa-heart"></i> for lovers of Azerbaijani cuisine',
    menu_open_btn: 'Open full menu',
    menu_download: 'Open image',
    menu_view_btn: 'View menu',
    reserve_open_btn: 'Reserve a table',
    reserve_title: 'Table reservation',
    reserve_branch: 'Branch',
    reserve_date: 'Date',
    reserve_time: 'Time',
    reserve_guests: 'Guests',
    reserve_phone: 'Phone',
    reserve_phone_placeholder: '+994...',
    reserve_email: 'Email (optional)',
    reserve_email_placeholder: 'name@example.com',
    reserve_message: 'Message',
    reserve_message_placeholder: 'Add any notes for your reservation',
    reserve_submit: 'Submit',
    reserve_success: 'Your reservation request has been sent. We will contact you by phone shortly.',
    reserve_error: 'Could not send the request. Please try again or contact us by phone.',
  },
};

function applyI18n(lang) {
  const dict = i18n[lang] || i18n.ru;
  // Update document language attribute for accessibility and SEO
  try { document.documentElement.setAttribute('lang', lang); } catch (_) {}
  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.getAttribute('data-i18n');
    const val = dict[key];
    if (typeof val === 'string') {
      el.innerHTML = val;
    }
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach((el) => {
    const key = el.getAttribute('data-i18n-placeholder');
    const val = dict[key];
    if (typeof val === 'string') {
      el.setAttribute('placeholder', val);
    }
  });
  // Set active state on lang buttons
  document.querySelectorAll('.lang-btn').forEach((btn) => {
    btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
  });
}

// Initial render with persisted language (default to AZ on first visit)
const defaultLang = localStorage.getItem('lang') || 'az';
applyI18n(defaultLang);

// Language switcher
document.querySelectorAll('.lang-btn').forEach((btn) => {
  btn.addEventListener('click', () => {
    const lang = btn.getAttribute('data-lang');
    localStorage.setItem('lang', lang);
    applyI18n(lang);
  });
});

// Reservation modal + form
function initReservation() {
  const modal = document.getElementById('reservation-modal');
  const openBtn = document.getElementById('open-reservation');
  const form = document.getElementById('reservation-form');
  const timeSelect = document.getElementById('reservation-time');
  const dateInput = document.getElementById('reservation-date');

  if (dateInput) {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    dateInput.min = `${yyyy}-${mm}-${dd}`;
    if (!dateInput.value) dateInput.value = `${yyyy}-${mm}-${dd}`;
  }

  function setBodyLocked(locked) {
    document.body.style.overflow = locked ? 'hidden' : '';
  }

  function openModal() {
    if (!modal) return;
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
    setBodyLocked(true);
  }

  function closeModal() {
    if (!modal) return;
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden', 'true');
    setBodyLocked(false);
  }

  function buildTimeOptions() {
    if (!timeSelect) return;
    timeSelect.innerHTML = '';

    const startMinutes = 9 * 60;
    const endMinutes = 24 * 60;
    for (let m = startMinutes; m <= endMinutes; m += 10) {
      const hh = String(Math.floor(m / 60)).padStart(2, '0');
      const mins = String(m % 60).padStart(2, '0');
      const label = `${hh}:${mins}`;
      const opt = document.createElement('option');
      opt.value = label;
      opt.textContent = label;
      timeSelect.appendChild(opt);
    }
    if (!timeSelect.value) timeSelect.value = '19:00';
  }

  buildTimeOptions();

  openBtn && openBtn.addEventListener('click', openModal);
  modal && modal.querySelectorAll('[data-close-modal="true"]').forEach((el) => {
    el.addEventListener('click', closeModal);
  });
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
  });

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      const payload = {
        branch: data.get('branch'),
        date: data.get('date'),
        time: data.get('time'),
        guests: data.get('guests'),
        phone: data.get('phone'),
        email: data.get('email'),
        message: data.get('message'),
      };

      if (!payload.phone) return;

      const lang = localStorage.getItem('lang') || 'ru';
      const dict = i18n[lang] || i18n.ru;

      const submitBtn = form.querySelector('button[type="submit"]');
      const spinner = form.querySelector('.btn-spinner');
      const prevDisabled = submitBtn ? submitBtn.disabled : false;
      if (submitBtn) submitBtn.disabled = true;
      if (spinner) spinner.classList.add('active');

      try {
        const res = await fetch('/.netlify/functions/reserve', {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const json = await res.json().catch(() => null);
        if (!res.ok || !json || json.ok !== true) throw new Error('send_failed');

        alert(dict.reserve_success);
        form.reset();
        buildTimeOptions();
        if (dateInput) dateInput.value = dateInput.min;
        closeModal();
      } catch (_) {
        alert(dict.reserve_error);
      } finally {
        if (submitBtn) submitBtn.disabled = prevDisabled;
        if (spinner) spinner.classList.remove('active');
      }
    });
  }
}

initReservation();

// Active nav link on scroll
const sections = document.querySelectorAll('section[id]');
const navAnchors = document.querySelectorAll('.nav-links a');
function onScroll() {
  let current = '';
  sections.forEach((section) => {
    const sectionTop = section.offsetTop - 120;
    if (pageYOffset >= sectionTop) current = section.getAttribute('id');
  });
  navAnchors.forEach((a) => {
    a.classList.remove('active');
    if (a.getAttribute('href') === `#${current}`) a.classList.add('active');
  });
}
window.addEventListener('scroll', onScroll);
onScroll();

// ============ About Gallery Slider ============
function initAboutGallery() {
  const gallery = document.querySelector('.about-gallery');
  if (!gallery) return;

  const track = gallery.querySelector('.about-gallery-track');
  const slides = Array.from(track ? track.querySelectorAll('img') : []);
  if (!track || slides.length === 0) return;

  const prevBtn = gallery.querySelector('.about-gallery-nav.prev');
  const nextBtn = gallery.querySelector('.about-gallery-nav.next');
  const dotsContainer = gallery.querySelector('.about-gallery-dots');
  let index = 0;

  // Create dots
  if (dotsContainer) {
    dotsContainer.innerHTML = '';
    slides.forEach((_, i) => {
      const dot = document.createElement('button');
      if (i === 0) dot.classList.add('active');
      dot.setAttribute('aria-label', `Slide ${i + 1}`);
      dot.addEventListener('click', () => goTo(i));
      dotsContainer.appendChild(dot);
    });
  }

  function update() {
    track.style.transform = `translateX(-${index * 100}%)`;
    if (dotsContainer) {
      dotsContainer.querySelectorAll('button').forEach((d, i) => {
        d.classList.toggle('active', i === index);
      });
    }
  }

  function goTo(i) {
    const total = slides.length;
    index = (i + total) % total;
    update();
  }

  prevBtn && prevBtn.addEventListener('click', () => goTo(index - 1));
  nextBtn && nextBtn.addEventListener('click', () => goTo(index + 1));

  // Swipe support (mobile-friendly)
  const SWIPE_MIN = 50;
  const SWIPE_MAX_OFF_AXIS = 70;
  let startX = 0;
  let startY = 0;
  let isDown = false;
  let activePointerId = null;
  let lastSwipeAt = 0;
  track.style.cursor = 'grab';
  try { track.style.touchAction = 'pan-y'; } catch (_) {}

  function finishSwipe(dx, dy) {
    const now = Date.now();
    // Mobile browsers can fire both pointer and touch events for a single gesture.
    // Guard to avoid advancing two slides.
    if (now - lastSwipeAt < 250) return;
    if (Math.abs(dx) < SWIPE_MIN) return;
    if (Math.abs(dy) > SWIPE_MAX_OFF_AXIS) return;
    lastSwipeAt = now;
    dx > 0 ? goTo(index - 1) : goTo(index + 1);
  }

  track.addEventListener('pointerdown', (e) => {
    isDown = true;
    activePointerId = e.pointerId;
    startX = e.clientX;
    startY = e.clientY;
    try { track.setPointerCapture(e.pointerId); } catch (_) {}
    track.style.cursor = 'grabbing';
  });

  track.addEventListener('pointerup', (e) => {
    if (!isDown) return;
    if (activePointerId !== null && e.pointerId !== activePointerId) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    finishSwipe(dx, dy);
    isDown = false;
    activePointerId = null;
    try { track.releasePointerCapture(e.pointerId); } catch (_) {}
    track.style.cursor = 'grab';
  });

  track.addEventListener('pointercancel', () => {
    isDown = false;
    activePointerId = null;
    track.style.cursor = 'grab';
  });

  // Touch fallback only when PointerEvent is not supported
  if (!('PointerEvent' in window)) {
    track.addEventListener(
      'touchstart',
      (e) => {
        if (!e.touches || e.touches.length !== 1) return;
        const t = e.touches[0];
        startX = t.clientX;
        startY = t.clientY;
      },
      { passive: true }
    );
    track.addEventListener(
      'touchend',
      (e) => {
        const t = e.changedTouches && e.changedTouches[0];
        if (!t) return;
        const dx = t.clientX - startX;
        const dy = t.clientY - startY;
        finishSwipe(dx, dy);
      },
      { passive: true }
    );
  }

  update();
}

initAboutGallery();

// ============ Reveal on Scroll ============
function initRevealOnScroll() {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.15 }
  );

  const revealables = document.querySelectorAll('.reveal');
  revealables.forEach((el) => observer.observe(el));

  return observer;
}

let revealObserver = initRevealOnScroll();

// Mark key static elements for reveal
document.querySelectorAll('section, .menu-item, .about-gallery, .contact-content, .footer-content, .navbar, .hero-content, .about-text h2, .about-text p').forEach((el, idx) => {
  el.classList.add('reveal');
  el.style.setProperty('--i', idx % 10);
});

// Re-init observer after marking
revealObserver.disconnect();
revealObserver = initRevealOnScroll();

// Ensure dynamically rendered menu items reveal (legacy compatibility)
const originalRenderMenu = typeof window.renderMenu === 'function' ? window.renderMenu : function(){};
window.renderMenu = function(category = 'hot') {
  // legacy no-op to avoid errors if called elsewhere
  try { originalRenderMenu(category); } catch (_) {}
};

*/
